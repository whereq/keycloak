{"version":3,"file":"keycloak.service.js","names":["KeycloakService","constructor","keycloak","_defineProperty","keycloakAuth","authenticated","audiencePresent","tokenParsed","audience","Array","isArray","indexOf","login","options","logout","redirectUri","baseUrl","account","accountManagement","authServerUrl","charAt","length","realm","getToken","Promise","resolve","reject","token","updateToken","then","catch"],"sources":["../../src/app/keycloak-service/keycloak.service.ts"],"sourcesContent":["/*\r\n * Copyright 2017 Red Hat, Inc. and/or its affiliates\r\n * and other contributors as indicated by the @author tags.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport Keycloak, { KeycloakLoginOptions } from \"../../../../../../../../../../js/libs/keycloak-js\";\r\n\r\ndeclare const baseUrl: string;\r\nexport type KeycloakClient = Keycloak;\r\n\r\nexport class KeycloakService {\r\n    private keycloakAuth: KeycloakClient;\r\n\r\n    public constructor(keycloak: KeycloakClient) {\r\n        this.keycloakAuth = keycloak;\r\n    }\r\n\r\n    public authenticated(): boolean {\r\n        return this.keycloakAuth.authenticated ? this.keycloakAuth.authenticated : false;\r\n    }\r\n\r\n    public audiencePresent(): boolean {\r\n        if (this.keycloakAuth.tokenParsed) {\r\n            const audience = this.keycloakAuth.tokenParsed['aud'];\r\n            return audience === 'account' || (Array.isArray(audience) && audience.indexOf('account') >= 0);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public login(options?: KeycloakLoginOptions): void {\r\n        this.keycloakAuth.login(options);\r\n    }\r\n\r\n    public logout(redirectUri: string = baseUrl): void {\r\n        this.keycloakAuth.logout({redirectUri: redirectUri});\r\n    }\r\n\r\n    public account(): void {\r\n        this.keycloakAuth.accountManagement();\r\n    }\r\n\r\n    public authServerUrl(): string | undefined {\r\n        const authServerUrl = this.keycloakAuth.authServerUrl;\r\n        return authServerUrl!.charAt(authServerUrl!.length - 1) === '/' ? authServerUrl : authServerUrl + '/';\r\n    }\r\n\r\n    public realm(): string | undefined {\r\n        return this.keycloakAuth.realm;\r\n    }\r\n\r\n    public getToken(): Promise<string> {\r\n        return new Promise<string>((resolve, reject) => {\r\n            if (this.keycloakAuth.token) {\r\n                this.keycloakAuth\r\n                    .updateToken(5)\r\n                    .then(() => {\r\n                        resolve(this.keycloakAuth.token as string);\r\n                    })\r\n                    .catch(() => {\r\n                        reject('Failed to refresh token');\r\n                    });\r\n            } else {\r\n                reject('Not logged in');\r\n            }\r\n        });\r\n    }\r\n}\r\n"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAMA,OAAO,MAAMA,eAAe,CAAC;EAGlBC,WAAWA,CAACC,QAAwB,EAAE;IAAAC,eAAA;IACzC,IAAI,CAACC,YAAY,GAAGF,QAAQ;EAChC;EAEOG,aAAaA,CAAA,EAAY;IAC5B,OAAO,IAAI,CAACD,YAAY,CAACC,aAAa,GAAG,IAAI,CAACD,YAAY,CAACC,aAAa,GAAG,KAAK;EACpF;EAEOC,eAAeA,CAAA,EAAY;IAC9B,IAAI,IAAI,CAACF,YAAY,CAACG,WAAW,EAAE;MAC/B,MAAMC,QAAQ,GAAG,IAAI,CAACJ,YAAY,CAACG,WAAW,CAAC,KAAK,CAAC;MACrD,OAAOC,QAAQ,KAAK,SAAS,IAAKC,KAAK,CAACC,OAAO,CAACF,QAAQ,CAAC,IAAIA,QAAQ,CAACG,OAAO,CAAC,SAAS,CAAC,IAAI,CAAE;IAClG;IACA,OAAO,KAAK;EAChB;EAEOC,KAAKA,CAACC,OAA8B,EAAQ;IAC/C,IAAI,CAACT,YAAY,CAACQ,KAAK,CAACC,OAAO,CAAC;EACpC;EAEOC,MAAMA,CAACC,WAAmB,GAAGC,OAAO,EAAQ;IAC/C,IAAI,CAACZ,YAAY,CAACU,MAAM,CAAC;MAACC,WAAW,EAAEA;IAAW,CAAC,CAAC;EACxD;EAEOE,OAAOA,CAAA,EAAS;IACnB,IAAI,CAACb,YAAY,CAACc,iBAAiB,CAAC,CAAC;EACzC;EAEOC,aAAaA,CAAA,EAAuB;IACvC,MAAMA,aAAa,GAAG,IAAI,CAACf,YAAY,CAACe,aAAa;IACrD,OAAOA,aAAa,CAAEC,MAAM,CAACD,aAAa,CAAEE,MAAM,GAAG,CAAC,CAAC,KAAK,GAAG,GAAGF,aAAa,GAAGA,aAAa,GAAG,GAAG;EACzG;EAEOG,KAAKA,CAAA,EAAuB;IAC/B,OAAO,IAAI,CAAClB,YAAY,CAACkB,KAAK;EAClC;EAEOC,QAAQA,CAAA,EAAoB;IAC/B,OAAO,IAAIC,OAAO,CAAS,CAACC,OAAO,EAAEC,MAAM,KAAK;MAC5C,IAAI,IAAI,CAACtB,YAAY,CAACuB,KAAK,EAAE;QACzB,IAAI,CAACvB,YAAY,CACZwB,WAAW,CAAC,CAAC,CAAC,CACdC,IAAI,CAAC,MAAM;UACRJ,OAAO,CAAC,IAAI,CAACrB,YAAY,CAACuB,KAAe,CAAC;QAC9C,CAAC,CAAC,CACDG,KAAK,CAAC,MAAM;UACTJ,MAAM,CAAC,yBAAyB,CAAC;QACrC,CAAC,CAAC;MACV,CAAC,MAAM;QACHA,MAAM,CAAC,eAAe,CAAC;MAC3B;IACJ,CAAC,CAAC;EACN;AACJ"}