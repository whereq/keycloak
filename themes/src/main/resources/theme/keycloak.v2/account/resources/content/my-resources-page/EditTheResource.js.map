{"version":3,"file":"EditTheResource.js","names":["React","Button","Modal","Form","FormGroup","TextInput","InputGroup","ModalVariant","OkIcon","Scope","Msg","AccountServiceContext","ContentAlert","PermissionSelect","EditTheResource","Component","constructor","props","context","_defineProperty","state","isOpen","setState","onClose","clearState","row","changed","savePermission","permission","doPut","encodeURIComponent","resource","_id","success","localize","render","createElement","Fragment","children","handleToggleDialog","title","name","variant","large","actions","key","id","onClick","msgKey","isHorizontal","permissions","map","p","fieldId","label","type","value","username","isDisabled","isRequired","scopes","selected","s","direction","length","onSelect","selection","updateChanged"],"sources":["../../../src/app/content/my-resources-page/EditTheResource.tsx"],"sourcesContent":["/*\r\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport * as React from 'react';\r\n\r\nimport {\r\n    Button,\r\n    Modal,\r\n    Form,\r\n    FormGroup,\r\n    TextInput,\r\n    InputGroup,\r\n    ModalVariant\r\n} from '@patternfly/react-core';\r\nimport { OkIcon } from '@patternfly/react-icons';\r\n\r\nimport { Resource, Permission, Permissions, Scope } from './resource-model';\r\nimport { Msg } from '../../widgets/Msg';\r\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\r\nimport { ContentAlert } from '../ContentAlert';\r\nimport { PermissionSelect } from './PermissionSelect';\r\n\r\ninterface EditTheResourceProps {\r\n    resource: Resource;\r\n    permissions: Permission[];\r\n    onClose: () => void;\r\n    children: (toggle: () => void) => void;\r\n}\r\n\r\ninterface EditTheResourceState {\r\n    changed: boolean[];\r\n    isOpen: boolean;\r\n}\r\n\r\nexport class EditTheResource extends React.Component<EditTheResourceProps, EditTheResourceState> {\r\n    protected static defaultProps:Permissions = { permissions: [] };\r\n    static contextType = AccountServiceContext;\r\n    context: React.ContextType<typeof AccountServiceContext>;\r\n\r\n    public constructor(props: EditTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\r\n        super(props);\r\n        this.context = context;\r\n\r\n        this.state = {\r\n            changed: [],\r\n            isOpen: false,\r\n        };\r\n    }\r\n\r\n    private clearState(): void {\r\n        this.setState({});\r\n    }\r\n\r\n    private handleToggleDialog = () => {\r\n        if (this.state.isOpen) {\r\n            this.setState({ isOpen: false });\r\n            this.props.onClose();\r\n        } else {\r\n            this.clearState();\r\n            this.setState({ isOpen: true });\r\n        }\r\n    };\r\n\r\n    private updateChanged = (row: number) => {\r\n        const changed = this.state.changed;\r\n        changed[row] = !changed[row];\r\n        this.setState({ changed });\r\n    }\r\n\r\n    async savePermission(permission: Permission): Promise<void> {\r\n        await this.context!.doPut(`/resources/${encodeURIComponent(this.props.resource._id)}/permissions`, [permission]);\r\n        ContentAlert.success(Msg.localize('updateSuccess'));\r\n    }\r\n\r\n    public render(): React.ReactNode {\r\n        return (\r\n            <React.Fragment>\r\n                {this.props.children(this.handleToggleDialog)}\r\n\r\n                <Modal\r\n                    title={'Edit the resource - ' + this.props.resource.name}\r\n                    variant={ModalVariant.large}\r\n                    isOpen={this.state.isOpen}\r\n                    onClose={this.handleToggleDialog}\r\n                    actions={[\r\n                        <Button key=\"done\" variant=\"link\" id=\"done\" onClick={this.handleToggleDialog}>\r\n                            <Msg msgKey='done' />\r\n                        </Button>,\r\n                    ]}\r\n                >\r\n                    <Form isHorizontal>\r\n                        {this.props.permissions.map((p, row) => (\r\n                            <React.Fragment>\r\n                                <FormGroup\r\n                                    fieldId={`username-${row}`}\r\n                                    label={Msg.localize('User')}\r\n                                >\r\n                                    <TextInput id={`username-${row}`} type=\"text\" value={p.username} isDisabled />\r\n\r\n                                </FormGroup>\r\n                                <FormGroup\r\n                                    fieldId={`permissions-${row}`}\r\n                                    label={Msg.localize('permissions')}\r\n                                    isRequired\r\n                                >\r\n                                    <InputGroup>\r\n                                        <PermissionSelect\r\n                                            scopes={this.props.resource.scopes}\r\n                                            selected={(p.scopes as string[]).map(s => new Scope(s))}\r\n                                            direction={row === this.props.permissions.length - 1 ? \"up\" : \"down\"}\r\n                                            onSelect={selection => {\r\n                                                p.scopes = selection.map(s => s.name);\r\n                                                this.updateChanged(row);\r\n                                            }}\r\n                                        />\r\n                                        <Button\r\n                                            id={`save-${row}`}\r\n                                            isDisabled={!this.state.changed[row]}\r\n                                            onClick={() => this.savePermission(p)}\r\n                                        >\r\n                                            <OkIcon />\r\n                                        </Button>\r\n                                    </InputGroup>\r\n                                </FormGroup>\r\n                                <hr />\r\n                            </React.Fragment>\r\n                        ))}\r\n                    </Form>\r\n                </Modal>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,KAAKA,KAAK;AAEjB,SACIC,MAAM,EACNC,KAAK,EACLC,IAAI,EACJC,SAAS,EACTC,SAAS,EACTC,UAAU,EACVC,YAAY;AAEhB,SAASC,MAAM;AAEf,SAA4CC,KAAK;AACjD,SAASC,GAAG;AACZ,SAASC,qBAAqB;AAC9B,SAASC,YAAY;AACrB,SAASC,gBAAgB;AAczB,OAAO,MAAMC,eAAe,SAASd,KAAK,CAACe,SAAS,CAA6C;EAKtFC,WAAWA,CAACC,KAA2B,EAAEC,OAAwD,EAAE;IACtG,KAAK,CAACD,KAAK,CAAC;IAACE,eAAA;IAAAA,eAAA,6BAaY,MAAM;MAC/B,IAAI,IAAI,CAACC,KAAK,CAACC,MAAM,EAAE;QACnB,IAAI,CAACC,QAAQ,CAAC;UAAED,MAAM,EAAE;QAAM,CAAC,CAAC;QAChC,IAAI,CAACJ,KAAK,CAACM,OAAO,CAAC,CAAC;MACxB,CAAC,MAAM;QACH,IAAI,CAACC,UAAU,CAAC,CAAC;QACjB,IAAI,CAACF,QAAQ,CAAC;UAAED,MAAM,EAAE;QAAK,CAAC,CAAC;MACnC;IACJ,CAAC;IAAAF,eAAA,wBAEwBM,GAAW,IAAK;MACrC,MAAMC,OAAO,GAAG,IAAI,CAACN,KAAK,CAACM,OAAO;MAClCA,OAAO,CAACD,GAAG,CAAC,GAAG,CAACC,OAAO,CAACD,GAAG,CAAC;MAC5B,IAAI,CAACH,QAAQ,CAAC;QAAEI;MAAQ,CAAC,CAAC;IAC9B,CAAC;IA1BG,IAAI,CAACR,OAAO,GAAGA,OAAO;IAEtB,IAAI,CAACE,KAAK,GAAG;MACTM,OAAO,EAAE,EAAE;MACXL,MAAM,EAAE;IACZ,CAAC;EACL;EAEQG,UAAUA,CAAA,EAAS;IACvB,IAAI,CAACF,QAAQ,CAAC,CAAC,CAAC,CAAC;EACrB;EAkBA,MAAMK,cAAcA,CAACC,UAAsB,EAAiB;IACxD,MAAM,IAAI,CAACV,OAAO,CAAEW,KAAK,CAAE,cAAaC,kBAAkB,CAAC,IAAI,CAACb,KAAK,CAACc,QAAQ,CAACC,GAAG,CAAE,cAAa,EAAE,CAACJ,UAAU,CAAC,CAAC;IAChHhB,YAAY,CAACqB,OAAO,CAACvB,GAAG,CAACwB,QAAQ,CAAC,eAAe,CAAC,CAAC;EACvD;EAEOC,MAAMA,CAAA,EAAoB;IAC7B,oBACInC,KAAA,CAAAoC,aAAA,CAACpC,KAAK,CAACqC,QAAQ,QACV,IAAI,CAACpB,KAAK,CAACqB,QAAQ,CAAC,IAAI,CAACC,kBAAkB,CAAC,eAE7CvC,KAAA,CAAAoC,aAAA,CAAClC,KAAK;MACFsC,KAAK,EAAE,sBAAsB,GAAG,IAAI,CAACvB,KAAK,CAACc,QAAQ,CAACU,IAAK;MACzDC,OAAO,EAAEnC,YAAY,CAACoC,KAAM;MAC5BtB,MAAM,EAAE,IAAI,CAACD,KAAK,CAACC,MAAO;MAC1BE,OAAO,EAAE,IAAI,CAACgB,kBAAmB;MACjCK,OAAO,EAAE,cACL5C,KAAA,CAAAoC,aAAA,CAACnC,MAAM;QAAC4C,GAAG,EAAC,MAAM;QAACH,OAAO,EAAC,MAAM;QAACI,EAAE,EAAC,MAAM;QAACC,OAAO,EAAE,IAAI,CAACR;MAAmB,gBACzEvC,KAAA,CAAAoC,aAAA,CAAC1B,GAAG;QAACsC,MAAM,EAAC;MAAM,CAAE,CAChB,CAAC;IACX,gBAEFhD,KAAA,CAAAoC,aAAA,CAACjC,IAAI;MAAC8C,YAAY;IAAA,GACb,IAAI,CAAChC,KAAK,CAACiC,WAAW,CAACC,GAAG,CAAC,CAACC,CAAC,EAAE3B,GAAG,kBAC/BzB,KAAA,CAAAoC,aAAA,CAACpC,KAAK,CAACqC,QAAQ,qBACXrC,KAAA,CAAAoC,aAAA,CAAChC,SAAS;MACNiD,OAAO,EAAG,YAAW5B,GAAI,EAAE;MAC3B6B,KAAK,EAAE5C,GAAG,CAACwB,QAAQ,CAAC,MAAM;IAAE,gBAE5BlC,KAAA,CAAAoC,aAAA,CAAC/B,SAAS;MAACyC,EAAE,EAAG,YAAWrB,GAAI,EAAE;MAAC8B,IAAI,EAAC,MAAM;MAACC,KAAK,EAAEJ,CAAC,CAACK,QAAS;MAACC,UAAU;IAAA,CAAE,CAEtE,CAAC,eACZ1D,KAAA,CAAAoC,aAAA,CAAChC,SAAS;MACNiD,OAAO,EAAG,eAAc5B,GAAI,EAAE;MAC9B6B,KAAK,EAAE5C,GAAG,CAACwB,QAAQ,CAAC,aAAa,CAAE;MACnCyB,UAAU;IAAA,gBAEV3D,KAAA,CAAAoC,aAAA,CAAC9B,UAAU,qBACPN,KAAA,CAAAoC,aAAA,CAACvB,gBAAgB;MACb+C,MAAM,EAAE,IAAI,CAAC3C,KAAK,CAACc,QAAQ,CAAC6B,MAAO;MACnCC,QAAQ,EAAGT,CAAC,CAACQ,MAAM,CAAcT,GAAG,CAACW,CAAC,IAAI,IAAIrD,KAAK,CAACqD,CAAC,CAAC,CAAE;MACxDC,SAAS,EAAEtC,GAAG,KAAK,IAAI,CAACR,KAAK,CAACiC,WAAW,CAACc,MAAM,GAAG,CAAC,GAAG,IAAI,GAAG,MAAO;MACrEC,QAAQ,EAAEC,SAAS,IAAI;QACnBd,CAAC,CAACQ,MAAM,GAAGM,SAAS,CAACf,GAAG,CAACW,CAAC,IAAIA,CAAC,CAACrB,IAAI,CAAC;QACrC,IAAI,CAAC0B,aAAa,CAAC1C,GAAG,CAAC;MAC3B;IAAE,CACL,CAAC,eACFzB,KAAA,CAAAoC,aAAA,CAACnC,MAAM;MACH6C,EAAE,EAAG,QAAOrB,GAAI,EAAE;MAClBiC,UAAU,EAAE,CAAC,IAAI,CAACtC,KAAK,CAACM,OAAO,CAACD,GAAG,CAAE;MACrCsB,OAAO,EAAEA,CAAA,KAAM,IAAI,CAACpB,cAAc,CAACyB,CAAC;IAAE,gBAEtCpD,KAAA,CAAAoC,aAAA,CAAC5B,MAAM,MAAE,CACL,CACA,CACL,CAAC,eACZR,KAAA,CAAAoC,aAAA,WAAK,CACO,CACnB,CACC,CACH,CACK,CAAC;EAEzB;AACJ;AAACjB,eAAA,CAlGYL,eAAe,kBACoB;EAAEoC,WAAW,EAAE;AAAG,CAAC;AAAA/B,eAAA,CADtDL,eAAe,iBAEHH,qBAAqB"}