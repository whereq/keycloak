{"version":3,"file":"ContentPages.js","names":["React","Route","Switch","NavItem","NavExpandable","Msg","PageNotFound","ForbiddenPage","isModulePageDef","item","modulePath","undefined","isExpansion","contentItem","content","groupId","group","itemId","isChildOf","parent","child","createNavItems","activePage","contentParam","groupNum","createElement","Fragment","links","map","navLinkId","id","key","title","localize","label","labelParams","isExpanded","page","to","path","isActive","type","makeNavItems","console","log","setIds","expansionGroupNum","i","length","initGroupAndItemIds","flattenContent","pageDefs","flat","push","makeRoutes","routes","node","module","componentName","exact","render","pageDef","component"],"sources":["../src/app/ContentPages.tsx"],"sourcesContent":["/*\r\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport * as React from 'react';\r\nimport {Route, Switch} from 'react-router-dom';\r\nimport {NavItem, NavExpandable} from '@patternfly/react-core';\r\nimport {Msg} from './widgets/Msg';\r\nimport {PageNotFound} from './content/page-not-found/PageNotFound';\r\nimport { ForbiddenPage } from './content/forbidden-page/ForbiddenPage';\r\n\r\nexport interface ContentItem {\r\n    id?: string;\r\n    label: string;\r\n    labelParams?: string[];\r\n    hidden?: string;\r\n    groupId: string; // computed value\r\n    itemId: string; // computed value\r\n};\r\n\r\nexport interface Expansion extends ContentItem {\r\n    content: ContentItem[];\r\n}\r\n\r\nexport interface PageDef extends ContentItem {\r\n    path: string;\r\n}\r\n\r\nexport interface ComponentPageDef extends PageDef {\r\n    component: React.ComponentType;\r\n}\r\n\r\nexport interface ModulePageDef extends PageDef {\r\n    modulePath: string;\r\n    componentName: string;\r\n    module: React.Component; // computed value\r\n}\r\n\r\nexport function isModulePageDef(item: ContentItem): item is ModulePageDef {\r\n    return (item as ModulePageDef).modulePath !== undefined;\r\n}\r\n\r\nexport function isExpansion(contentItem: ContentItem): contentItem is Expansion {\r\n    return (contentItem as Expansion).content !== undefined;\r\n}\r\n\r\ndeclare const content: ContentItem[];\r\n\r\nfunction groupId(group: number): string {\r\n    return 'grp-' + group;\r\n}\r\n\r\nfunction itemId(group: number, item: number): string {\r\n    return 'grp-' + group + '_itm-' + item;\r\n}\r\n\r\nfunction isChildOf(parent: Expansion, child: PageDef): boolean {\r\n    for (var item of parent.content) {\r\n        if (isExpansion(item) && isChildOf(item, child)) return true;\r\n        if (parent.groupId === child.groupId) return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction createNavItems(activePage: PageDef, contentParam: ContentItem[], groupNum: number): React.ReactNode {\r\n    if (typeof content === 'undefined') return (<React.Fragment/>);\r\n\r\n    const links: React.ReactElement[] = contentParam.map((item: ContentItem) => {\r\n        const navLinkId = `nav-link-${item.id}`;\r\n        if (isExpansion(item)) {\r\n            return <NavExpandable id={navLinkId}\r\n                                  groupId={item.groupId}\r\n                                  key={item.groupId}\r\n                                  title={Msg.localize(item.label, item.labelParams)}\r\n                                  isExpanded={isChildOf(item, activePage)}\r\n                                  >\r\n                        {createNavItems(activePage, item.content, groupNum + 1)}\r\n                    </NavExpandable>\r\n        } else {\r\n            const page: PageDef = item as PageDef;\r\n            return <NavItem id={navLinkId}\r\n                            groupId={item.groupId}\r\n                            itemId={item.itemId}\r\n                            key={item.itemId}\r\n                            to={'#/' + page.path}\r\n                            isActive={activePage.itemId === item.itemId}\r\n                            type=\"button\">\r\n                        {Msg.localize(page.label, page.labelParams)}\r\n                    </NavItem>\r\n        }\r\n    });\r\n\r\n    return (<React.Fragment>{links}</React.Fragment>);\r\n}\r\n\r\nexport function makeNavItems(activePage: PageDef): React.ReactNode {\r\n    console.log({activePage});\r\n    return createNavItems(activePage, content, 0);\r\n}\r\n\r\nfunction setIds(contentParam: ContentItem[], groupNum: number): number {\r\n    if (typeof contentParam === 'undefined') return groupNum;\r\n    let expansionGroupNum = groupNum;\r\n\r\n    for (let i = 0; i < contentParam.length; i++) {\r\n        const item: ContentItem = contentParam[i];\r\n        if (isExpansion(item)) {\r\n            item.itemId = itemId(groupNum, i);\r\n            expansionGroupNum = expansionGroupNum + 1;\r\n            item.groupId = groupId(expansionGroupNum);\r\n            expansionGroupNum = setIds(item.content, expansionGroupNum);\r\n            console.log('currentGroup=' + (expansionGroupNum));\r\n        } else {\r\n            item.groupId = groupId(groupNum);\r\n            item.itemId = itemId(groupNum, i);\r\n        }\r\n    };\r\n\r\n    return expansionGroupNum;\r\n}\r\n\r\nexport function initGroupAndItemIds(): void {\r\n    setIds(content, 0);\r\n    console.log({content});\r\n}\r\n\r\n// get rid of Expansions and put all PageDef items into a single array\r\nexport function flattenContent(pageDefs: ContentItem[]): PageDef[] {\r\n    const flat: PageDef[] = [];\r\n\r\n    for (let item of pageDefs) {\r\n        if (isExpansion(item)) {\r\n            flat.push(...flattenContent(item.content));\r\n        } else {\r\n            flat.push(item as PageDef);\r\n        }\r\n    }\r\n\r\n    return flat;\r\n}\r\n\r\nexport function makeRoutes(): React.ReactNode {\r\n    if (typeof content === 'undefined') return (<span/>);\r\n\r\n    const pageDefs: PageDef[] = flattenContent(content);\r\n\r\n    const routes: React.ReactElement<Route>[] = pageDefs.map((page: PageDef) => {\r\n        if (isModulePageDef(page)) {\r\n            const node: React.ReactNode = React.createElement(page.module[page.componentName], {'pageDef': page});\r\n            return <Route key={page.itemId} path={'/' + page.path} exact render={() => node} />;\r\n        } else {\r\n            const pageDef: ComponentPageDef = page as ComponentPageDef;\r\n            return <Route key={page.itemId} path={'/' + page.path} exact component={pageDef.component}/>;\r\n        }\r\n    });\r\n\r\n    return (<Switch>\r\n                {routes}\r\n                <Route path=\"/forbidden\" component={ForbiddenPage}/>\r\n                <Route component={PageNotFound}/>\r\n            </Switch>);\r\n}\r\n"],"mappings":"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"}