{"version":3,"file":"ShareTheResource.js","names":["React","Button","Chip","ChipGroup","Form","FormGroup","Gallery","GalleryItem","Modal","Stack","StackItem","TextInput","ModalVariant","AccountServiceContext","Msg","ContentAlert","PermissionSelect","ShareTheResource","Component","constructor","props","context","_defineProperty","rscId","resource","_id","newPermissions","permission","state","permissionsSelected","push","name","permissions","username","usernames","scopes","handleToggleDialog","doPut","encodeURIComponent","then","success","onClose","isOpen","setState","clearState","usernameInput","includes","response","doGet","params","value","data","info","event","key","preventDefault","handleAddUsername","newUsernames","filter","user","permissionsUnSelected","isAddDisabled","isAlreadyShared","isFormInvalid","length","render","createElement","Fragment","children","title","variant","large","actions","onClick","msgKey","id","handleAddPermission","isDisabled","hasGutter","isFilled","label","type","helperTextInvalid","localize","fieldId","isRequired","placeholder","onChange","handleUsernameChange","onKeyPress","handleEnterKeyInAddField","categoryName","map","currentChip","handleDeleteUsername","onSelect","selection","direction","sharedWithUsersMsg"],"sources":["../../../src/app/content/my-resources-page/ShareTheResource.tsx"],"sourcesContent":["/*\r\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport * as React from 'react';\r\n\r\nimport {\r\n    Button,\r\n    Chip,\r\n    ChipGroup,\r\n    Form,\r\n    FormGroup,\r\n    Gallery,\r\n    GalleryItem,\r\n    Modal,\r\n    Stack,\r\n    StackItem,\r\n    TextInput,\r\n    ModalVariant\r\n} from '@patternfly/react-core';\r\n\r\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\r\nimport { Resource, Permission, Scope } from './resource-model';\r\nimport { Msg } from '../../widgets/Msg';\r\nimport {ContentAlert} from '../ContentAlert';\r\nimport { PermissionSelect } from './PermissionSelect';\r\n\r\ninterface ShareTheResourceProps {\r\n    resource: Resource;\r\n    permissions: Permission[];\r\n    sharedWithUsersMsg: React.ReactNode;\r\n    onClose: () => void;\r\n    children: (toggle: () => void) => void;\r\n}\r\n\r\ninterface ShareTheResourceState {\r\n    isOpen: boolean;\r\n    permissionsSelected: Scope[];\r\n    permissionsUnSelected: Scope[];\r\n    usernames: string[];\r\n    usernameInput: string;\r\n}\r\n\r\n/**\r\n * @author Stan Silvert ssilvert@redhat.com (C) 2019 Red Hat Inc.\r\n */\r\nexport class ShareTheResource extends React.Component<ShareTheResourceProps, ShareTheResourceState> {\r\n    protected static defaultProps:any = {permissions: []};\r\n    static contextType = AccountServiceContext;\r\n    context: React.ContextType<typeof AccountServiceContext>;\r\n\r\n    public constructor(props: ShareTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\r\n        super(props);\r\n        this.context = context;\r\n    \r\n        this.state = {\r\n            isOpen: false,\r\n            permissionsSelected: [],\r\n            permissionsUnSelected: this.props.resource.scopes,\r\n            usernames: [],\r\n            usernameInput: ''\r\n        };\r\n    }\r\n\r\n    private clearState(): void {\r\n        this.setState({\r\n            permissionsSelected: [],\r\n            permissionsUnSelected: this.props.resource.scopes,\r\n            usernames: [],\r\n            usernameInput: ''\r\n        });\r\n    }\r\n\r\n    private handleAddPermission = () => {\r\n        const rscId: string = this.props.resource._id;\r\n        const newPermissions: string[] = [];\r\n\r\n        for (const permission of this.state.permissionsSelected) {\r\n            newPermissions.push(permission.name);\r\n        }\r\n\r\n        const permissions = [];\r\n\r\n        for (const username of this.state.usernames) {\r\n            permissions.push({username: username, scopes: newPermissions});\r\n        }\r\n\r\n        this.handleToggleDialog();\r\n\r\n        this.context!.doPut(`/resources/${encodeURIComponent(rscId)}/permissions`, permissions)\r\n            .then(() => {\r\n                ContentAlert.success('shareSuccess');\r\n                this.props.onClose();\r\n            })\r\n    };\r\n\r\n    private handleToggleDialog = () => {\r\n       if (this.state.isOpen) {\r\n           this.setState({isOpen: false});\r\n           this.props.onClose();\r\n       } else {\r\n           this.clearState();\r\n           this.setState({isOpen: true});\r\n       }\r\n    };\r\n\r\n    private handleUsernameChange = (username: string) => {\r\n        this.setState({usernameInput: username});\r\n    }\r\n\r\n    private handleAddUsername = async () => {\r\n        if ((this.state.usernameInput !== '') && (!this.state.usernames.includes(this.state.usernameInput))) {\r\n            const response = await this.context!.doGet<{username: string}>(`/resources/${encodeURIComponent(this.props.resource._id)}/user`, { params: { value: this.state.usernameInput } });\r\n            if (response.data && response.data.username) {\r\n                this.setState({ usernameInput: '', usernames: [...this.state.usernames, this.state.usernameInput] });\r\n            } else {\r\n                ContentAlert.info('userNotFound', [this.state.usernameInput]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleEnterKeyInAddField = (event: React.KeyboardEvent) => {\r\n        if (event.key === \"Enter\") {\r\n            event.preventDefault();\r\n            this.handleAddUsername();\r\n        }\r\n    }\r\n\r\n    private handleDeleteUsername = (username: string) => {\r\n        const newUsernames: string[] = this.state.usernames.filter(user => user !== username);\r\n        this.setState({usernames: newUsernames});\r\n    }\r\n\r\n    private isAddDisabled(): boolean {\r\n        return this.state.usernameInput === '' || this.isAlreadyShared();\r\n    }\r\n\r\n    private isAlreadyShared(): boolean {\r\n        for (let permission of this.props.permissions) {\r\n            if (permission.username === this.state.usernameInput) return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private isFormInvalid(): boolean {\r\n        return (this.state.usernames.length === 0) || (this.state.permissionsSelected.length === 0);\r\n    }\r\n\r\n    public render(): React.ReactNode {\r\n        return (\r\n            <React.Fragment>\r\n                {this.props.children(this.handleToggleDialog)}\r\n\r\n                <Modal\r\n                title={'Share the resource - ' + this.props.resource.name}\r\n                variant={ModalVariant.large}\r\n                isOpen={this.state.isOpen}\r\n                onClose={this.handleToggleDialog}\r\n                actions={[\r\n                    <Button key=\"cancel\" variant=\"link\" onClick={this.handleToggleDialog}>\r\n                        <Msg msgKey='cancel'/>\r\n                    </Button>,\r\n                    <Button key=\"confirm\" variant=\"primary\" id=\"done\" onClick={this.handleAddPermission} isDisabled={this.isFormInvalid()}>\r\n                        <Msg msgKey='done'/>\r\n                    </Button>\r\n                ]}\r\n                >\r\n                    <Stack hasGutter>\r\n                        <StackItem isFilled>\r\n                        <Form>\r\n                            <FormGroup\r\n                                label=\"Add users to share your resource with\"\r\n                                type=\"string\"\r\n                                helperTextInvalid={Msg.localize('resourceAlreadyShared')}\r\n                                fieldId=\"username\"\r\n                                isRequired\r\n                                >\r\n                                    <Gallery hasGutter>\r\n                                        <GalleryItem>\r\n                                            <TextInput\r\n                                                value={this.state.usernameInput}\r\n                                                id=\"username\"\r\n                                                aria-describedby=\"username-helper\"\r\n                                                placeholder=\"Username or email\"\r\n                                                onChange={this.handleUsernameChange}\r\n                                                onKeyPress={this.handleEnterKeyInAddField}\r\n                                            />\r\n                                        </GalleryItem>\r\n                                        <GalleryItem>\r\n                                            <Button key=\"add-user\" variant=\"primary\" id=\"add\" onClick={this.handleAddUsername} isDisabled={this.isAddDisabled()}>\r\n                                                <Msg msgKey=\"add\"/>\r\n                                            </Button>\r\n                                        </GalleryItem>\r\n\r\n                                </Gallery>\r\n                                <ChipGroup categoryName={Msg.localize('shareWith')}>\r\n                                    {this.state.usernames.map((currentChip: string) => (\r\n                                        <Chip key={currentChip} onClick={() => this.handleDeleteUsername(currentChip)}>\r\n                                            {currentChip}\r\n                                        </Chip>\r\n                                    ))}\r\n                                </ChipGroup>\r\n                            </FormGroup>\r\n                            <FormGroup\r\n                                label=\"\"\r\n                                fieldId=\"permissions-selected\"\r\n                            >\r\n                                <PermissionSelect\r\n                                    scopes={this.state.permissionsUnSelected}\r\n                                    onSelect={selection => this.setState({ permissionsSelected: selection })}\r\n                                    direction=\"up\"\r\n                                />\r\n                            </FormGroup>\r\n                        </Form>\r\n                    </StackItem>\r\n                    <StackItem isFilled><br/></StackItem>\r\n                    <StackItem isFilled>\r\n                        {this.props.sharedWithUsersMsg}\r\n                    </StackItem>\r\n\r\n                    </Stack>\r\n                </Modal>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n"],"mappings":"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"}